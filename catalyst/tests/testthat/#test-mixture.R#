library(testthat)
devtools::load_all()

context("mixture models")

test_that("generating the data",{
    N <- 100
    T <- 8
    x0 <- 1

    w <- 1
    p1 <- 1
    p2 <- 1
    agent_data <- gen_mix_2_data(w, p1, p2,
                                 N, T,
                                 x0)$agent_data
    expect_true(all(unlist(agent_data[-1,]) == 1))

###
    w <- 0
    p1 <- 0
    p2 <- 1
    agent_data <- gen_mix_2_data(w, p1, p2,
                                 N, T,
                                 x0)$agent_data
    expect_true(all(unlist(agent_data[-1,]) == 1))
###
                                        #    set.seed(2019)
    N <- 10000
    T <- 2
    x0 <- 1
    w <- .5
    p1 <- .6
    p2 <- .1
    agent_data_list <- gen_mix_2_data(w, p1, p2,
                                 N, T,
                                 x0)
    agent_data_list$Z
    agent_data <- agent_data_list$agent_data
    agent_data
    devtools::load_all()
    ## Try it out
    theta0 <- c(.4, .5, .1)
    out <- EM_mix_2(theta0, agent_data)
    out

})
